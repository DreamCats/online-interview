# RocketMQ 实现延迟队列

Rocketmq 发送延时消息时先把消息按照延迟时间段发送到指定的队列中(rocketmq 把每种延迟时间段的消息都存放到同一个队列中)；

接着通过一个定时器进行轮训这些队列，查看消息是否到期，如果到期就把这个消息发送到指定 topic 的队列中，

这样的好处是同一队列中的消息延时时间是一致的，还有一个好处是这个队列中的消息时按照消息到期时间进行递增排序的，说的简单直白就是队列中消息越靠前的到期时间越早。

缺点：定时器采用了 timer，timer 是单线程运行，如果延迟消息数量很大的情况下，可能单线程处理不过来，造成消息到期后也没有发送出去的情况。

改进点：可以在每个延迟队列上各采用一个 timer，或者使用 timer 进行扫描，加一个线程池对消息进行处理，这样可以提供效率。
