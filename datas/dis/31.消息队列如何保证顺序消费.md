# 消息队列如何保证顺序消费

生产者中把 orderId 进行取模，把相同模的数据放到 messagequeue 里面，消费者消费同一个 messagequeue，只要消费者这边有序消费，那么可以保证数据被顺序消费。

RocketMQ：顺序消息一般使用集群模式，是指对消息消费者内的线程池中的线程对消息消费队列只能串行消费。并并发消息消费最本质的区别是消息消费时必须成功锁定消息消费队列，在 Broker 端会存储消息消费队列的锁占用情况。

在 RocketMQ 中：

顺序消息分为分区顺序消息和全局顺序消息，全局顺序消息比较容易理解，也就是哪条消息先进入，哪条消息就会先被消费，符合我们的 FIFO，很多时候全局消息的实现代价很大，所以就出现了分区顺序消息。

淡然，我们通过对消息的 key，进行 hash，相同 hash 的消息会被分配到同一个分区里面，如果要做全局顺序消息，我们的分区只需要一个即可，所以全局顺序消息的代价是比较大的。
