## ArrayList有哪些并发问题

> 其实就是**size++** 这一步的问题。 越界就是两个线程临界值去**扩容**都满足，于是一个线程size++导致的，另外一个线程就溢出了，**null就是element[size] = e**,第一个线程还没来得及size++，第二个线程就在原先的索引上把值给覆盖了，并且在下一个索引为null。

越界

- 列表大小为9，即size=9
- 线程A开始进入add方法，这时它获取到size的值为9，调用ensureCapacityInternal方法进行容量判断。
- 线程B此时也进入add方法，它和获取的size的值也为9，也开始调用ensureCapacityInternal方法。
- 线程A发现需求大小为10，而elementData的大小就为10，可以容纳。于是它不再扩容，返回。
- 线程B也发现需要大小为10，也可以容纳，返回。
- 好了，**问题来了哈**
- 线程A开始进行设置值操作，elementData[size++] = e操作。此时size变为10。
- 线程B也开始进行设置值操作，它尝试设置elementData[10] = e, 而elementData没有进行过扩容，它的下标最大为9
- 于是此时会报出一个数组越界的异常`ArrayIndexOutOfBoundsException`。

null

- 列表大小为10，即size=0
- 线程A开始添加元素，值为A。此时它执行第一条操作，将A放在了elementData下标为0的位置上。也就是说，线程挂在了`element[0] = e`上。
- 接着线程B刚好也要开始添加一个值为B的元素，且走到了第一条的操作。此时线程B获取的size的值依然为0，于是它将B也放在了elementData下标为0的位置上。
- **问题来了**，其实上面也是问题，覆盖了。。。
- 线程A将size的值增加为1
- 线程B开始将size的值增加为2
- 当你获取1索引的时候，那不就是null了？